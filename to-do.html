<link rel="import" href="bower_components/polymer/polymer.html">
<link rel="import" href="bower_components/paper-drawer-panel/paper-drawer-panel.html">
<link rel="import" href="bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="bower_components/paper-menu/paper-menu.html">
<link rel="import" href="bower_components/paper-item/paper-item.html">
<link rel="import" href="bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="bower_components/iron-icons/iron-icons.html">
<link rel="import" href="bower_components/paper-material/paper-material.html">
<link rel="import" href="bower_components/paper-header-panel/paper-header-panel.html">
<link rel="import" href="bower_components/iron-icon/iron-icon.html">
<link rel="import" href="bower_components/iron-icons/iron-icons.html">
<link rel="import" href="bower_components/paper-input/paper-input.html">
<link rel="import" href="bower_components/paper-fab/paper-fab.html">
<link rel="import" href="bower_components/firebase-element/firebase-auth.html">
<link rel="import" href="bower_components/firebase-element/firebase-collection.html">

<dom-module id='to-do'>
<style type="custom-style">
	:host{
		height: 100%;
	}
	#menuContainer{
		background-color: #7986CB;
		color: white;
	}
	#container{
		padding: 12px 12px 12px 12px;
	}
	#content{
		padding: 12px 12px 12px 12px;
		margin: 12px 12px 12px 12px;
	}
	.error{
		height: 100%;
		color:  #f44336;
		background-color: #ffcdd2;
	}
	.profile{
		width: 64px;
		height: 64px;
		border-radius: 50%;
		background-repeat: no-repeat;
		background-position: center center;
		background-size: cover;
	}
	#dropdown{
		color: white;
	}
</style>
<template>
	<firebase-auth
		id="firebaseLogin"
		autoLogin="true"
		location="https://burning-torch-6048.firebaseio.com"
		provider="google"
		user="{{user}}"
		statusKnown="{{statusknown}}"></firebase-auth>

	<firebase-collection
      location="{{location}}"
      data="{{response}}"></firebase-collection>

	<paper-drawer-panel responsive-width="720px">
		<paper-header-panel drawer mode="seamed">
			<paper-toolbar>
				<span class="flex" style="font-weight:500;font-size:22px;">Options</span>
			</paper-toolbar>
			<div id="menuContainer" class="fit">
				<paper-menu id="menuContainer" selected="0">
					<paper-item>To-Do list</paper-item>
					<paper-item>Item</paper-item>
					<paper-item>Item</paper-item>
				</paper-menu>
			</div>
		</paper-header-panel>
		<paper-header-panel main mode="standard">
			<paper-toolbar>
				<paper-icon-button icon="menu" paper-drawer-toggle></paper-icon-button>
				<span class="flex" style="font-weight:500;font-size:22px;">To-Do App</span>
				<template is="dom-if" if="{{!signedIn}}">
					<iron-icon icon="account-circle" on-click="login"></iron-icon>
				</template>
				<span on-click="logout">{{userName}}</span>
			</paper-toolbar>

			<div id="container">
				<template is="dom-if" if="{{!signedIn}}">
					<div class="error">Please Signin!</div>
				</template>
				<template is="dom-if" if="{{signedIn}}">
					<paper-material id="content" elevation="1">
						<div class="horizontal layout">
							<paper-input class="flex" floatingLabel label="Add a Reminder here" value="{{remainder}}"></paper-input>
							<paper-fab mini icon="add" on-click="submit">Add</paper-fab>
						</div>
					</paper-material>
					<template is="dom-repeat" items="[[response]]" as="item">
						<paper-material id="content" elevation="1">
							<span>{{item.remainderData}}</span>
						</paper-material>
					</template>
				</template>
			</div>
		</paper-header-panel>
	</paper-drawer-panel>
</template>
</dom-module>

<script src="bower_components/firebase/firebase.js"></script>
<script>
	Polymer({
		is: "to-do",
		properties: {
			signedIn: {
				value: false,
				type: Boolean
			},
			statusknown: {
				value: true,
				type: Boolean,
				readOnly: true,
				notify: true
			},
			user: {
				type: Object
			},
			userName: {
				value: '',
				type:String
			},
			uid: {
				type: String
			},
			response: Object,
			location:{
				type: String,
				computed: 'urlLocation(uid)' 
			},
			remainder: String

		},
		ready: function(){
			console.log('Ready');
		},
		statusknownChanged: function(){
			console.log('Changed');
		},
		login: function(){
			this.$.firebaseLogin.login();
			this.signedIn = true;
			console.log('Logged In');
			this.userName = this.user.google.displayName;
			this.uid = this.user.google.id;
		},
		logout: function(){
			this.$.firebaseLogin.logout();
			this.signedIn = false;
			console.log('Logged Out');
			this.userName = '';
			this.uid = '';
		},
		urlLocation: function(uid){
			console.log("https://burning-torch-6048.firebaseio.com/to-do-userdb/"+uid);
			return "https://burning-torch-6048.firebaseio.com/to-do-userdb/"+uid;
		},
		submit: function(){
			console.log(this.location);
			console.log(this.remainder);
			var write = new Firebase(this.location);
			if (this.remainder != undefined){
				console.log('Submiting...');
				var remainderData = this.remainder;
				write.push({
					remainderData
			});
			console.log('Added');
			}
			
		}
	});
</script>