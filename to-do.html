<link rel="import" href="bower_components/polymer/polymer.html">
<link rel="import" href="bower_components/paper-drawer-panel/paper-drawer-panel.html">
<link rel="import" href="bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="bower_components/paper-menu/paper-menu.html">
<link rel="import" href="bower_components/paper-item/paper-item.html">
<link rel="import" href="bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="bower_components/iron-icons/iron-icons.html">
<link rel="import" href="bower_components/paper-material/paper-material.html">
<link rel="import" href="bower_components/paper-header-panel/paper-header-panel.html">
<link rel="import" href="bower_components/google-signin/google-signin.html">
<link rel="import" href="bower_components/google-signin/google-signin-aware.html">
<link rel="import" href="bower_components/firebase-element/firebase-collection.html">

<dom-module id='to-do'>
<style type="custom-style">
	:host{
		height: 100%;
	}
	#menuContainer{
		background-color: #7986CB;
		color: white;
	}
	#container{
		padding: 12px 12px 12px 12px;
	}
	#content{
		padding: 12px 12px 12px 12px;
		margin: 12px 12px 12px 12px;
	}
	.error{
		height: 100%;
		color:  #f44336;
		background-color: #ffcdd2;
	}
</style>
<template>
	<paper-drawer-panel responsive-width="720px">
		<paper-header-panel drawer mode="seamed">
			<paper-toolbar>
				<span class="flex" style="font-weight:500;font-size:22px;">Options</span>
			</paper-toolbar>
			<div id="menuContainer" class="fit">
				<paper-menu id="menuContainer" selected="0">
					<paper-item>To-Do list</paper-item>
					<paper-item>Item</paper-item>
					<paper-item>Item</paper-item>
				</paper-menu>
			</div>
		</paper-header-panel>
		<paper-header-panel main mode="standard">
			<paper-toolbar>
				<paper-icon-button icon="menu" paper-drawer-toggle></paper-icon-button>
				<span class="flex" style="font-weight:500;font-size:22px;">To-Do App</span>
				<google-signin-aware
					signedIn="{{signedIn}}"
					isAuthorized ="{{isAuthorized}}"
					needAdditionalAuth="{{needAdditionalAuth}}"
					on-google-signin-aware-success="handleSignIn"
					on-google-signin-aware-signed-out="handleSignOut"></google-signin-aware>
				<span>{{userName}}</span>
				<google-signin id="signin"
					fetch-basic-profile
					label-signin="Sign-in"
					client-id="1059854283183-7f2de4irvn0akf6dn9ippfnth5sh7qp6.apps.googleusercontent.com"></google-signin>
			</paper-toolbar>
			<div id="container">
				<template is="dom-if" if="{{!signedIn}}">
					<div class="error">Please Signin!</div>
				</template>
				<template is="dom-if" if="{{signedIn}}">
					<firebase-collection
						id="firebase"
						orderByKey="true"
						location="https://burning-torch-6048.firebaseio.com/to-do-userdb"
						data="{{dbResponse}}"
						></firebase-collection>
					<template is="dom-repeat" items="[[dbResponse]]" as="item">
						<paper-material id="content" elevation="1">
							Content 1<span>[[item.__firebaseKey__]]</span>
						</paper-material>
					</template>
				</template>
			</div>
		</paper-header-panel>
	</paper-drawer-panel>
</template>
</dom-module>

<script src="bower_components/firebase/firebase.js"></script>
<script>
	Polymer({
		is: "to-do",
		properties: {
			signedIn: {
				value: false,
				type: Boolean
			},
			id : String,
			dbResponse: Object,
			isAuthorized: Boolean,
			needAdditionalAuth: Boolean,
			userName: String
		},
		handleSignIn: function(response){
			this.signedIn = true;
			this.userName = gapi.auth2.getAuthInstance().currentUser.get().getBasicProfile().getName();
			console.log(response);
			var idV = gapi.auth2.getAuthInstance().currentUser.get().getId();
			var db = new Firebase("https://burning-torch-6048.firebaseio.com/to-do-userdb");
			db.push(
				{
					idV : 
					{
						"name": this.userName
					}
				});
			console.log(this.dbResponse);
		},
		handleSignOut: function(response){	
			console.log("Signed Out "+response);
			this.signedIn = false;
			this.userName = '';
		}
	});
</script>